{% extends "base_internal.html" %}

{% block title -%}
books
{%- endblock %}


{% block header_append %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/books.css') }}" />
<script src="{{ url_for('static', filename='js/books.js') }}"></script>
{%- endblock %}


{% block body -%}
<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" style="display:none">
    <symbol viewBox="0 0 20 20" id="speech_bubble">
        <path d="M0 0C0 0 0 13.8947 6.40825 19.4525C11.1847 23.5951 27.7691 2.77893 15.6646 5.55787C3.56014 8.3368 0 0 0 0Z" />
    </symbol>
    <symbol viewBox="0 0 448 512" id="angle-down-solid">
        <!--! Font Awesome Pro 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
        <path d="M201.4 342.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 274.7 86.6 137.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z"/>
    </symbol>
    <symbol 
    
</svg>
<div id="book_main">
    <div id="container_top">
        <div id="content_book_img" class="book_contents">
            <img src="{{ book_info.book.image_url }}" />
        </div>
        <div id="content_book_detail" class="book_contents">
            <div id="book_details">
                <table id="book_details_table">
                    <tr>
                        <td colspan="2">
                            <span id="book_name">{{ book_info.book.book_name }}</span><br />
                        </td>
                    </tr>
                    <tr>
                        <td class="book_detail_header">著者</td>
                        <td>
                            {%- for a in book_info.authors -%}
                            {% if loop.index0 > 0 %}、{% endif -%}
                            {{ a.author_name -}}
                            {% endfor -%}
                        </td>
                    </tr>
                    <tr>
                        <td class="book_detail_header">概要</td>
                        <td>
                            {{ book_info.collection.description }}
                        </td>
                    </tr>
                    {% if book_info.book.published_dt -%}
                    <tr>
                        <td class="book_detail_header">出版日</td>
                        <td>{{ book_info.book.published_dt.strftime('%Y/%m/%d') }}</td>
                    </tr>
                    {% endif -%}
                    {% if book_info.publisher -%}
                    <tr>
                        <td class="book_detail_header">出版社</td>
                        <td>{{ book_info.publisher.publisher_name }}</td>
                    </tr>
                    {% endif -%}
                    <tr>
                        <td class="book_detail_header">ジャンル</td>
                        <td>
                            {%- for g in book_info.genres -%}
                            {% if loop.index0 > 0 %}&nbsp;/&nbsp;{% endif -%}
                            {{ g.genre_name -}}
                            {% endfor -%}
                        </td>
                    </tr>
                    <tr>
                        <td class="book_detail_header">所有数</td>
                        <td>
                            {{ book_info.collection.num_of_same_books }}冊
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <div id="content_buttons" class="book_contents">
            <form method="POST" action="{{ url_for('borrow_book') }}">
                {{ borrow_form.csrf_token }}
                {{ borrow_form.book_id }}
                <button type="submit" class="btn_submit">借りる</button>
            </form>
            <form method="POST" action="{{ url_for('return_book') }}">
                {{ return_form.csrf_token }}
                {{ return_form.book_id }}
                <button type="submit" class="btn_submit">返す</button>
            </form>
            {% if member.is_admin -%}
            <hr />
            <form method="POST" action="{{ url_for('return_book') }}">
                {{ return_form.csrf_token }}
                {{ return_form.book_id }}
                <button type="submit" class="btn_submit btn_submit_admin">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" height="16px">
                        <use xlink:href="#wrench"></use>
                    </svg>
                    編集
                </button>
            </form>
            {% endif -%}
        </div>
    </div>
    <div id="container_bottom">
        <div id="content_comment">
            <div class="contents_title">
                コメント
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" id="angle_down">
                    <use xlink:href="#angle-down-solid"></use>
                </svg>
            </div>
            <div id="comments">
                <form method="POST" action="{{ url_for('note_book') }}">
                    {{ note_form.csrf_token }}
                    {{ note_form.book_id }}
                    <div class="one_comment">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" height="20px">
                            <use xlink:href="#user"></use>
                        </svg>
                        <div class="comment_area">
                            <div class="member_name_comment_dt">
                                <a href="{{ url_for('members', member_id=member.member_id) }}">
                                    {{ member.member_name }}
                                </a>
                            </div>
                            <div id="div_note_regist_form">
                                {{ note_form.note }}
                                <button class="btn_submit">
                                    コメント
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
                {% for note_member in notes -%}
                <div class="one_comment">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" height="20px">
                        <use xlink:href="#user"></use>
                    </svg>
                    <div class="comment_area">
                        <div class="member_name_comment_dt">
                            <a href="{{ url_for('members', member_id=member.member_id) }}">
                                {{ note_member[1].member_name }}
                            </a>
                            {{ note_member[0].noted_dt.strftime("%Y/%m/%d %H:%M") }}
                        </div>
                        <div class="comment_str">
                            {{ note_member[0].note|safe }}
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" height="16px">
                                <use xlink:href="#speech_bubble"></use>
                            </svg>
                        </div>
                    </div>
                </div>
                {% endfor -%}
            </div>
        </div>
        <div id="content_borrowed_his">
            <div class="contents_title">貸出履歴</div>
            <div id="borrowed_his">
            </div>
        </div>
    </div>
</div>

<hr />
<hr />
<hr />
{% if message -%}
<p>message:{{ message }}</p>
{% endif -%}
book_id: {{ book_info.book.book_id }}<br />
isbn: {{ book_info.book.isbn }}<br />
book_name: {{ book_info.book.book_name }}<br />
img: <img src="{{ book_info.book.image_url }}" /><br />
publisher_id: {{ book_info.book.publisher_id }}<br />
publisher_name: {{ book_info.publisher }}<br />
published_dt: {{ book_info.book.published_dt }}<br />
description: {{ book_info.book.description }}<br />
page_count: {{ book_info.book.page_count }}<br />
dimensions_height: {{ book_info.book.dimensions_height }}<br />
dimensions_width: {{ book_info.book.dimensions_width }}<br />
dimensions_thickness: {{ book_info.book.dimensions_thickness }}<br />
authors: {% for a in book_info.authors -%}
- {{ a.author_name }}<br />
{% endfor -%}
genres: {% for g in book_info.genres -%}
- {{ g.genre_name }}<br />
{% endfor -%}
<form method="POST">
    {{ edit_form.csrf_token }}
num_of_same_books: {{ edit_form.num_of_same_books }}<br />
-- his --<br />
<table border="1">
    <tr>
        <th>member</th>
        <th>borrowed_dt</th>
        <th>returned_dt</th>
    </tr>
    {% for h in book_info.histories -%}
    <tr>
        <td><a href="{{ url_for('members', member_id=h.member.member_id) }}">{{ h.member.member_name }}</a></td>
        <td>{{ h.borrowed_history.borrowed_dt }}</td>
        <td>{{ h.borrowed_history.returned_dt }}</td>
    </tr>
    {% endfor -%}
</table>

-- notes --<br />
<table border="1">
    <tr>
        <th>member</th>
        <th>noted_dt</th>
        <th>note</th>
    </tr>
    {% for n in book_info.book_notes -%}
    <tr>
        <td><a href="{{ url_for('members', member_id=n.member.member_id) }}">{{ n.member.member_name }}</a></td>
        <td>{{ n.book_note.noted_dt }}</td>
        <td>{{ n.book_note.note }}</td>
    </tr>
    {% endfor -%}
</table>


<hr />
    <button type="submit">数の変更</button>
</form>
<form method="POST" action="{{ url_for('borrow_book') }}">
    {{ borrow_form.csrf_token }}
    {{ borrow_form.book_id }}
    <button type="submit">本を借りる</button>
</form>
<form method="POST" action="{{ url_for('return_book') }}">
    {{ return_form.csrf_token }}
    {{ return_form.book_id }}
    <button type="submit">本を返す</button>
</form>
<form method="POST" action="{{ url_for('note_book') }}">
    {{ note_form.csrf_token }}
    {{ note_form.book_id }}
    {{ note_form.note }}
    <button type="submit">ノート</button>
</form>
<script language="JavaScript">
    make_breadcrumbs([
        [
            "蔵書一覧",
            "{{ url_for('main') }}"
        ],
        [
            "{{ book_info.book.book_name }}",
            "{{ url_for('books', book_id=book_info.book.book_id) }}"
        ]
    ]);
</script>
{% endblock -%}
